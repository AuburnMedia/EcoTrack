{% extends 'layouts/base.html' %}
{% load static %}

{% block title %} EcoTrack | Dashboard {% endblock title %}

{% block extrastyle %}
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="{% static 'plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css' %}">
  <!-- iCheck -->
  <link rel="stylesheet" href="{% static 'plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">
  <!-- JQVMap -->
  <link rel="stylesheet" href="{% static 'plugins/jqvmap/jqvmap.min.css' %}">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="{% static 'plugins/daterangepicker/daterangepicker.css' %}">
  <!-- summernote -->
  <link rel="stylesheet" href="{% static 'plugins/summernote/summernote-bs4.min.css' %}">
  <!-- Chart.js -->
  <link rel="stylesheet" href="{% static 'plugins/chart.js/Chart.min.css' %}">
{% endblock extrastyle %}

{% block bodyclass %} hold-transition sidebar-mini layout-fixed {% endblock bodyclass %}

{% block content %}
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0">Dashboard</h1>
          </div><!-- /.col -->
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="#">Home</a></li>
              <li class="breadcrumb-item active">Dashboard</li>
            </ol>
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <!-- Left Column -->
          <div class="col-lg-8">
            <!-- Area Chart -->
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">
                  <i class="fas fa-chart-area mr-1"></i>
                  Area Chart
                </h3>
                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                  </button>
                </div>
              </div>
              <div class="card-body">
                <canvas id="areaChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
              </div>
            </div>
            <!-- /.card -->

            <!-- Previous Results Table -->
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">
                  <i class="fas fa-history mr-1"></i>
                  Previous Results
                </h3>
                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                  </button>
                </div>
              </div>
              <div class="card-body table-responsive p-0">
                <table class="table table-hover text-nowrap">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Carbon est.</th>
                      <th>%</th>
                      <th>More</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>3 weeks ago</td>
                      <td>13</td>
                      <td><span class="text-success"><i class="fas fa-arrow-up"></i> 16% 12,000</span></td>
                      <td><a href="#" class="btn btn-sm btn-default"><i class="fas fa-search"></i></a></td>
                    </tr>
                    <tr>
                      <td>2 weeks ago</td>
                      <td>29</td>
                      <td><span class="text-warning"><i class="fas fa-arrow-up"></i> 4% 123,234</span></td>
                      <td><a href="#" class="btn btn-sm btn-default"><i class="fas fa-search"></i></a></td>
                    </tr>
                    <tr>
                      <td>Last week</td>
                      <td>1230</td>
                      <td><span class="text-danger"><i class="fas fa-arrow-down"></i> 3% 108</span></td>
                      <td><a href="#" class="btn btn-sm btn-default"><i class="fas fa-search"></i></a></td>
                    </tr>
                    <tr>
                      <td>Today <span class="badge badge-danger">NEW</span></td>
                      <td>199</td>
                      <td><span class="text-success"><i class="fas fa-arrow-up"></i> 8% 87</span></td>
                      <td><a href="#" class="btn btn-sm btn-default"><i class="fas fa-search"></i></a></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <!-- /.card -->
          </div>
          <!-- /.col -->

          <!-- Right Column -->
          <div class="col-lg-4">
            <!-- Your Carbon Usage -->
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">
                  <i class="fas fa-leaf mr-1"></i>
                  Your Carbon Usage
                </h3>
                <div class="card-tools">
                  <a href="#" class="btn btn-sm btn-primary">View Report</a>
                </div>
              </div>
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <div>
                    <h2 class="text-bold mb-0">$18,230.00</h2>
                    <p class="text-muted mb-0">Carbon Usage Over Time</p>
                  </div>
                  <div class="text-right">
                    <span class="text-success"><i class="fas fa-arrow-up"></i> 11.1%</span>
                    <p class="text-muted mb-0 small">Since last month</p>
                  </div>
                </div>
                <canvas id="carbonUsageChart" style="min-height: 180px; height: 180px; max-height: 180px; max-width: 100%;"></canvas>
                <div class="mt-3">
                  <div class="d-flex justify-content-between">
                    <span><i class="fas fa-square text-primary"></i> Your usage</span>
                    <span><i class="fas fa-square text-secondary"></i> Average Usage</span>
                  </div>
                </div>
              </div>
            </div>
            <!-- /.card -->

            <!-- Footprint Estimator -->
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">
                  <i class="fas fa-calculator mr-1"></i>
                  Use our footprint estimator!
                </h3>
              </div>
              <div class="card-body">
                <p>You haven't taken the checkup ['in' | 'time_since_last'] if time_since_last else ""]</p>
                <p class="text-muted">Our footprint estimator can estimate your carbon usage in only a few questions.</p>
                <a href="#" class="btn btn-primary">Go somewhere</a>
              </div>
            </div>
            <!-- /.card -->

            <!-- Goal Progress -->
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">
                  <i class="fas fa-target mr-1"></i>
                  Goal Progress
                </h3>
              </div>
              <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                  <div class="progress-circle mr-3">
                    <canvas id="goalProgressChart" width="80" height="80"></canvas>
                  </div>
                  <div>
                    <h4 class="text-bold mb-0">X%</h4>
                    <p class="text-muted mb-0">Progress</p>
                  </div>
                </div>
                <div class="alert alert-info">
                  <p class="mb-2"><strong>At this current rate, it will take you 15 weeks to reach your current goal!</strong></p>
                  <a href="#" class="btn btn-primary btn-sm">Go somewhere</a>
                </div>
              </div>
            </div>
            <!-- /.card -->
          </div>
          <!-- /.col -->
        </div>
        <!-- /.row -->
      </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>
{% endblock content %}

{% block extra_scripts %}
  <!-- jQuery UI 1.11.4 -->
  <script src="{% static 'plugins/jquery-ui/jquery-ui.min.js' %}"></script>
  <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
  <script>
    $.widget.bridge('uibutton', $.ui.button)
  </script>

  <!-- ChartJS -->
  <script src="{% static 'plugins/chart.js/Chart.min.js' %}"></script>
  <!-- Sparkline -->
  <script src="{% static 'plugins/sparklines/sparkline.js' %}"></script>
  <!-- JQVMap -->
  <script src="{% static 'plugins/jqvmap/jquery.vmap.min.js' %}"></script>
  <script src="{% static 'plugins/jqvmap/maps/jquery.vmap.usa.js' %}"></script>
  <!-- jQuery Knob Chart -->
  <script src="{% static 'plugins/jquery-knob/jquery.knob.min.js' %}"></script>
  <!-- daterangepicker -->
  <script src="{% static 'plugins/moment/moment.min.js' %}"></script>
  <script src="{% static 'plugins/daterangepicker/daterangepicker.js' %}"></script>
  <!-- Tempusdominus Bootstrap 4 -->
  <script src="{% static 'plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js' %}"></script>
  <!-- Summernote -->
  <script src="{% static 'plugins/summernote/summernote-bs4.min.js' %}"></script>
  <!-- overlayScrollbars -->
  <script src="{% static 'plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js' %}"></script>
  <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
  <script src="{% static 'dist/js/pages/dashboard.js' %}"></script>
  
  <script>
    // Area Chart
    var areaChartCanvas = $('#areaChart').get(0).getContext('2d');
    var areaChartData = {
      labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
      datasets: [
        {
          label: 'Dataset 1',
          backgroundColor: 'rgba(60,141,188,0.9)',
          borderColor: 'rgba(60,141,188,0.8)',
          pointRadius: false,
          pointColor: '#3b8bba',
          pointStrokeColor: 'rgba(60,141,188,1)',
          pointHighlightFill: '#fff',
          pointHighlightStroke: 'rgba(60,141,188,1)',
          data: [28, 48, 40, 19, 86, 27, 90]
        },
        {
          label: 'Dataset 2',
          backgroundColor: 'rgba(210, 214, 222, 1)',
          borderColor: 'rgba(210, 214, 222, 1)',
          pointRadius: false,
          pointColor: 'rgba(210, 214, 222, 1)',
          pointStrokeColor: '#c1c7d1',
          pointHighlightFill: '#fff',
          pointHighlightStroke: 'rgba(220,220,220,1)',
          data: [65, 59, 80, 81, 56, 55, 40]
        },
      ]
    };

    var areaChartOptions = {
      maintainAspectRatio: false,
      responsive: true,
      legend: {
        display: false
      },
      scales: {
        xAxes: [{
          gridLines: {
            display: false,
          }
        }],
        yAxes: [{
          gridLines: {
            display: false,
          }
        }]
      }
    };

    new Chart(areaChartCanvas, {
      type: 'line',
      data: areaChartData,
      options: areaChartOptions
    });

    // Carbon Usage Bar Chart
    var carbonUsageCanvas = $('#carbonUsageChart').get(0).getContext('2d');
    var carbonUsageData = {
      labels: ['JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'],
      datasets: [
        {
          label: 'Your usage',
          backgroundColor: '#007bff',
          data: [1000, 1200, 1800, 1500, 1700, 1600, 1900]
        },
        {
          label: 'Average Usage',
          backgroundColor: '#6c757d',
          data: [800, 900, 1000, 950, 1100, 1050, 1200]
        }
      ]
    };

    var carbonUsageOptions = {
      maintainAspectRatio: false,
      responsive: true,
      legend: {
        display: false
      },
      scales: {
        xAxes: [{
          gridLines: {
            display: false,
          }
        }],
        yAxes: [{
          gridLines: {
            display: false,
          },
          ticks: {
            callback: function(value) {
              return '$' + value;
            }
          }
        }]
      }
    };

    new Chart(carbonUsageCanvas, {
      type: 'bar',
      data: carbonUsageData,
      options: carbonUsageOptions
    });

    // Goal Progress Doughnut Chart
    var goalProgressCanvas = $('#goalProgressChart').get(0).getContext('2d');
    var progressPercentage = 35; // You can make this dynamic

    var goalProgressData = {
      datasets: [{
        data: [progressPercentage, 100 - progressPercentage],
        backgroundColor: ['#28a745', '#e9ecef'],
        borderWidth: 0
      }]
    };

    var goalProgressOptions = {
      maintainAspectRatio: false,
      responsive: true,
      cutoutPercentage: 80,
      legend: {
        display: false
      },
      tooltips: {
        enabled: false
      }
    };

    new Chart(goalProgressCanvas, {
      type: 'doughnut',
      data: goalProgressData,
      options: goalProgressOptions
    });

    // Update the X% text with actual percentage
    $('.progress-circle').next().find('h4').text(progressPercentage + '%');
  </script>
{% endblock extra_scripts %}

